<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NumeraWealth — Trader (Square/Cash App)</title>

  <!-- React, Tailwind, Babel -->
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.20.15/babel.min.js"></script>

  <style>
    /* Trader theme & subtle animations */
    .bg-trader {
      background:
        radial-gradient(1200px 800px at 10% 10%, rgba(16,185,129,0.12), transparent 60%),
        radial-gradient(900px 700px at 90% 20%, rgba(6,182,212,0.12), transparent 60%),
        linear-gradient(135deg, #0b1220, #0a0f1a, #0b1220);
      background-size: 200% 200%;
      animation: gradientShift 18s ease-in-out infinite;
    }
    @keyframes gradientShift { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
    .grid-overlay::before{ content:""; position:absolute; inset:-100px;
      background-image:
        linear-gradient(rgba(99,102,241,0.06) 1px,transparent 1px),
        linear-gradient(90deg, rgba(99,102,241,0.06) 1px,transparent 1px);
      background-size:40px 40px,40px 40px; transform:translateZ(0); animation:gridDrift 40s linear infinite; pointer-events:none; }
    @keyframes gridDrift { 0%{transform:translate3d(0,0,0)} 100%{transform:translate3d(-80px,-40px,0)} }
    .scanlines::after{ content:""; position:absolute; inset:0; background:repeating-linear-gradient(to bottom, rgba(255,255,255,0.02), rgba(255,255,255,0.02) 1px, transparent 2px, transparent 4px ); mix-blend-mode:soft-light; pointer-events:none; }
    .glass-card{ background:rgba(13,18,30,.7); backdrop-filter:blur(10px); border:1px solid rgba(100,116,139,.25); box-shadow:0 10px 30px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.02); transition: box-shadow .25s ease, border-color .25s ease, transform .2s ease; }
    .glass-card:hover{ border-color:rgba(16,185,129,.45); box-shadow:0 12px 36px rgba(16,185,129,.15), inset 0 0 0 1px rgba(16,185,129,.15); transform:translateY(-1px); }
    .btn-primary{ background:linear-gradient(90deg,#10b981,#06b6d4); box-shadow:0 8px 24px rgba(16,185,129,.25), 0 2px 8px rgba(6,182,212,.15); transition:transform .12s ease, box-shadow .2s ease, opacity .2s ease; }
    .btn-primary:hover{ transform:translateY(-1px); box-shadow:0 10px 28px rgba(16,185,129,.3), 0 3px 10px rgba(6,182,212,.2); }
    .btn-ghost{ border:1px solid rgba(148,163,184,.25); background:rgba(30,41,59,.6); transition: border-color .2s, transform .12s; }
    .btn-ghost:hover{ border-color:rgba(16,185,129,.5); transform:translateY(-1px); }
    .input{ background:rgba(15,23,42,.6); border:1px solid rgba(148,163,184,.25); color:#e5e7eb; }
    .pill{ border:1px solid rgba(148,163,184,.25); background:rgba(30,41,59,.6) }
    .master { color:#34d399; font-weight:600; }
    .badge { font-size:.75rem; padding:.15rem .5rem; border-radius:.5rem; border:1px solid rgba(148,163,184,.25); background:rgba(30,41,59,.6) }
    .modal-bg { background:rgba(0,0,0,.65); }
    .note { font-size:.9rem; color:#a5b4fc }
    /* in-page error panel */
    #fatal { position:fixed; left:12px; right:12px; bottom:12px; background:#111827; color:#fecaca; border:1px solid #ef4444; padding:12px; border-radius:12px; z-index:99999; max-height:45vh; overflow:auto; font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; display:none; }
    #fatal strong { color:#fca5a5 }
  </style>
</head>

<body class="min-h-screen bg-trader relative text-slate-200">
  <div class="grid-overlay scanlines absolute inset-0"></div>
  <div id="root" class="relative z-10 min-h-screen flex items-center justify-center p-4">Loading…</div>
  <pre id="fatal"></pre>

  <!-- global error catcher so a bug never shows a blank page -->
  <script>
    (function(){
      function showFatal(title, err){
        const el = document.getElementById('fatal');
        const msg = (err && (err.stack || err.message)) || String(err || '');
        el.innerHTML = "<strong>"+title+"</strong>\n\n"+msg;
        el.style.display = 'block';
        console.error('[NumeraWealth]', title, err);
      }
      window.__fatal = showFatal;
      window.addEventListener('error', e => showFatal(e.message, e.error));
      window.addEventListener('unhandledrejection', e => showFatal('Unhandled promise rejection', e.reason));
      console.log('[NumeraWealth] booting…');
    })();
  </script>

  <script type="text/babel">
    const { useState, useEffect } = React;

    /* === Price & Square Payment Link === */
    const PRICE_TEXT = '$1.99 for 30 days';
    // ⬇️ PASTE your Square Payment Link URL below (Square Dashboard → Payment links → Copy link)
    const PAYMENT_LINK_URL = 'PASTE_YOUR_SQUARE_PAYMENT_LINK_URL';

    /* === Access + Trial (client side + optional server verify) === */
    const ACCESS_TOKEN_KEY = 'nw:access:token';
    const TRIAL_KEY = 'nw:trial:used';

    const getToken = () => localStorage.getItem(ACCESS_TOKEN_KEY) || '';
    const setToken = (t) => localStorage.setItem(ACCESS_TOKEN_KEY, t || '');
    const clearToken = () => localStorage.removeItem(ACCESS_TOKEN_KEY);
    const hasTrialUsed = ()=> localStorage.getItem(TRIAL_KEY) === '1';
    const markTrialUsed = ()=> localStorage.setItem(TRIAL_KEY, '1');

    async function fetchJSON(url, opts={}) {
      const res = await fetch(url, opts);
      let data = null;
      try { data = await res.json(); } catch {}
      if (!res.ok) {
        const msg = (data && data.error) ? data.error : `HTTP ${res.status}`;
        throw new Error(msg);
      }
      return data;
    }

    async function checkAccess() {
      const token = getToken();
      if (!token) return { active:false, daysLeft:0 };
      try {
        const data = await fetchJSON('/api/access/status', {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        return data;
      } catch {
        return { active:false, daysLeft:0 };
      }
    }

    // Square flow: redirect to PAYMENT_LINK_URL; Square redirects back to your site.
    // If Square appends identifiers, this tries to verify via your server (optional).
    async function completeCheckoutFromURL(onUnlocked, setUiError) {
      const params = new URLSearchParams(window.location.search);
      const paid = params.get('paid'); // set in your Square link's redirect URL (e.g., https://site/?paid=1)
      const txn = params.get('transactionId') || params.get('paymentId') || params.get('payment_id') || '';
      const orderId = params.get('orderId') || params.get('order_id') || '';
      if (!paid && !txn && !orderId) return;

      if (txn || orderId) {
        try {
          const qs = new URLSearchParams({ txn, orderId });
          const data = await fetchJSON(`/api/verify-session?${qs.toString()}`);
          if (data?.token) {
            setToken(data.token);
            ['paid','transactionId','paymentId','payment_id','orderId','order_id'].forEach(k=>params.delete(k));
            const clean = `${window.location.origin}${window.location.pathname}${params.toString() ? '?'+params.toString() : ''}`;
            window.history.replaceState({}, '', clean);
            onUnlocked?.();
            return;
          }
        } catch (e) {
          setUiError?.(`Verification error: ${e.message}`);
        }
      }
      setUiError?.('Payment completed. If access is not unlocked yet, please wait a moment and press Calculate again.');
    }

    async function startCheckout(setUiError) {
      try {
        setUiError('');
        if (!PAYMENT_LINK_URL || PAYMENT_LINK_URL.startsWith('PASTE_')) {
          throw new Error('Missing PAYMENT_LINK_URL. Paste your Square Payment Link URL into the script.');
        }
        window.location.href = PAYMENT_LINK_URL;
      } catch (e) {
        setUiError(`Checkout error: ${e.message}`);
      }
    }

    /* ===== Numerology core ===== */
    const MASTER = new Set([11,22,33]);
    const LETTER_VALUES = {A:1,B:2,C:3,D:4,E:5,F:6,G:7,H:8,I:9,J:1,K:2,L:3,M:4,N:5,O:6,P:7,Q:8,R:9,S:1,T:2,U:3,V:4,W:5,X:6,Y:7,Z:8};
    const VOWELS = new Set(['A','E','I','O','U']);
    const onlyLetters = (s)=> (s||'').toUpperCase().replace(/[^A-Z\s'-]/g,'');
    const splitWords = (s)=> onlyLetters(s).split(/[ \-']+/).filter(Boolean);
    const sumDigits = (n)=> String(Math.abs(Number(n)||0)).split('').reduce((s,d)=>s+Number(d),0);
    const reduceNumber = (n)=>{ n=Math.abs(Number(n)||0); while(n>9 && !MASTER.has(n)) n=sumDigits(n); return n; };
    const reduceComponents = (...nums)=> reduceNumber(nums.map(reduceNumber).reduce((a,b)=>a+b,0));
    const isVowelY = (word, i)=>{
      const c=[...word], prev=c[i-1], next=c[i+1];
      const nextV = next && VOWELS.has(next); const prevV = prev && VOWELS.has(prev); const prevC = prev && !prevV;
      if (i===0 && nextV) return false;
      if (nextV) return false;
      if (prevC && !nextV) return true;
      if (!prevV && !nextV) return true;
      return false;
    };
    const classifyNameLetters = (name)=>{
      const words=splitWords(name);
      let vowelsSum=0, consonantsSum=0, allSum=0;
      for (const w of words){
        for (let i=0;i<w.length;i++){
          const ch=w[i];
          if (ch==='Y'){
            if (isVowelY(w,i)) vowelsSum+=LETTER_VALUES[ch]||0; else consonantsSum+=LETTER_VALUES[ch]||0;
          } else if (VOWELS.has(ch)) {
            vowelsSum+=LETTER_VALUES[ch]||0;
          } else {
            consonantsSum+=LETTER_VALUES[ch]||0;
          }
          allSum+=LETTER_VALUES[ch]||0;
        }
      }
      return {vowelsSum, consonantsSum, allSum};
    };
    const todayChicago = ()=>{
      const parts = new Intl.DateTimeFormat('en-US',{timeZone:'America/Chicago',year:'numeric',month:'2-digit',day:'2-digit'}).formatToParts(new Date());
      const get = (t)=> Number(parts.find(p=>p.type===t).value);
      const m=get('month'), d=get('day'), y=get('year');
      return {m,d,y,str:`${String(m).padStart(2,'0')}/${String(d).padStart(2,'0')}/${y}`};
    };
    const parseBirth = (s)=>{
      const a=(s||'').trim().split('/'); if (a.length!==3) return null;
      const [M,D,Y]=a.map(Number);
      if (!M||!D||!Y||M<1||M>12||Y<1800||Y>3000) return null;
      const maxD=new Date(Y,M,0).getDate(); if (D<1||D>maxD) return null;
      return {m:M,d:D,y:Y};
    };
    const validateFullBirthName = (name)=>{
      const words=splitWords(name);
      if (words.length<3) return {ok:false,msg:'Enter your full birth name: First Middle Last.'};
      const mids=words.slice(1,-1);
      if (mids.some(w=>w.length<2)) return {ok:false,msg:'Please enter your FULL middle name (no initials).'};
      return {ok:true,msg:''};
    };
    const calcLifePath = (b)=> reduceComponents(b.m,b.d,b.y);
    const calcExpression = (name)=> { const {allSum}=classifyNameLetters(name); return reduceNumber(allSum); };
    const calcSoulUrge  = (name)=> { const {vowelsSum}=classifyNameLetters(name); return reduceNumber(vowelsSum); };
    const calcPersonality=(name)=>{ const {consonantsSum}=classifyNameLetters(name); return {compound:consonantsSum, reduced:reduceNumber(consonantsSum)}; };
    const calcPersonalYear  =(t,b)=> reduceNumber(reduceNumber(b.m)+reduceNumber(b.d)+reduceNumber(t.y));
    const calcPersonalMonth =(t,b)=> reduceNumber(calcPersonalYear(t,b)+t.m);
    const calcPersonalDay   =(t,b)=> reduceNumber(calcPersonalMonth(t,b)+t.d);

    const PD_FINANCE = {
      1:"Initiation day: open pilot trades, start positions, or launch a plan. Keep risk defined.",
      2:"Partnership day: collaborate, hedge, or build balanced strategies. Patience wins.",
      3:"Communication day: share ideas, write notes, review trade plans; keep position sizes light.",
      4:"Structure day: tighten risk, rebalance, reduce debt, and build checklists.",
      5:"Volatility day: trade momentum or quick opportunities, but cap size and respect stops.",
      6:"Income day: focus on cash flow—dividends, covered calls, budgets, and necessary repairs.",
      7:"Research day: backtest, study the market, wait for A+ setups; fewer trades, higher quality.",
      8:"Power day: push negotiations, scale winners, review performance metrics.",
      9:"Completion day: harvest profits, cut weak positions, clean up accounts, and reset.",
      11:"Insight day: take small, high-upside opportunities from clear signals; protect capital.",
      22:"Build day: automate, systematize, and lay long-term foundations that compound.",
      33:"Service day: mentor, support clients, and strengthen relationships that create value."
    };
    const PM_FINANCE = {
      1:"Month of fresh starts: initiate projects, set targets, and define your risk framework.",
      2:"Month of alignment: build partnerships, negotiate terms, and refine hedges.",
      3:"Month to be seen: share ideas, publish content, and expand your audience.",
      4:"Month of discipline: control costs, improve processes, and document procedures.",
      5:"Month of agility: test new channels, iterate quickly, and avoid overtrading.",
      6:"Month of maintenance: protect cash flow, nurture clients, and upgrade essentials.",
      7:"Month of research: backtest, study markets, and quietly prepare systems.",
      8:"Month of execution: pursue scale, performance reviews, and clear return goals.",
      9:"Month of pruning: exit weak lines, consolidate, and finalize outstanding tasks.",
      11:"Month of insight: generate ideas, prototype carefully, and validate signals.",
      22:"Month of building: create scalable foundations, infrastructure, and automation.",
      33:"Month of service: deepen relationships, deliver value, and build goodwill."
    };
    const LP_TINT = {
      1:" Favor bold but measured starts.", 2:" Favor cooperation and nuance.",
      3:" Favor creativity and clear communication.", 4:" Favor process and durability.",
      5:" Favor flexibility and adaptation.", 6:" Favor stewardship and quality.",
      7:" Favor analysis, timing, and patience.", 8:" Favor ambition and metrics.",
      9:" Favor perspective and pruning.", 11:" Favor intuition with verification.",
      22:" Favor scalable systems and foundations.", 33:" Favor teaching and service."
    };
    const getDailyFinanceForecast   = (pd,lp)=> (PD_FINANCE[pd]||"Balanced day: follow the plan and manage risk.") + (LP_TINT[lp]||"");
    const getMonthlyFinanceForecast = (pm,lp)=> (PM_FINANCE[pm]||"Steady month: compound small advantages.") + (LP_TINT[lp]||"");
    const fmtNum = (n)=> MASTER.has(n) ? `${n} (Master)` : String(n);
    const masterHighlights = (r)=>{
      const tags = [];
      if (MASTER.has(r.lifePath)) tags.push(`Life Path ${r.lifePath}`);
      if (MASTER.has(r.expression)) tags.push(`Expression ${r.expression}`);
      if (MASTER.has(r.soulUrge)) tags.push(`Soul Urge ${r.soulUrge}`);
      if (MASTER.has(r.personality.reduced)) tags.push(`Personality ${r.personality.reduced}`);
      if (MASTER.has(r.py)) tags.push(`Personal Year ${r.py}`);
      if (MASTER.has(r.pm)) tags.push(`Personal Month ${r.pm}`);
      if (MASTER.has(r.pd)) tags.push(`Personal Day ${r.pd}`);
      return tags.length ? tags.join(", ") : "None";
    };

    const Card = ({title,value,children}) => (
      <div className="rounded-2xl p-4 pill">
        <div className="text-xs uppercase tracking-wide text-slate-400">{title}</div>
        <div className="text-lg md:text-xl font-semibold text-slate-100 whitespace-pre-wrap leading-relaxed mt-1">{value}</div>
        {children}
      </div>
    );

    const Paywall = ({onCheckout, uiError})=>{
      const [busy,setBusy] = useState(false);
      return (
        <div className="fixed inset-0 modal-bg flex items-center justify-center p-4">
          <div className="glass-card rounded-2xl max-w-lg w-full p-6">
            <h2 className="text-2xl font-bold mb-2">Unlock 30-Day Access</h2>
            <p className="text-slate-300 mb-4">
              Pay <span className="font-semibold">{PRICE_TEXT}</span> securely via Square.
              (Cash App Pay supported when enabled in your Square link.)
            </p>
            <button disabled={busy} onClick={()=>{ setBusy(true); onCheckout().finally(()=>setBusy(false)); }} className="btn-primary w-full text-white py-2 rounded-lg">
              {busy ? 'Starting checkout…' : 'Pay & Unlock'}
            </button>
            {uiError && <div className="mt-3 p-2 rounded-lg bg-red-900/40 text-red-200 border border-red-500/30 text-sm">{uiError}</div>}
            <p className="text-xs text-slate-400 mt-3">
              After payment you’ll return here automatically. If your server verifies payments, access unlocks for 30 days.
            </p>
          </div>
        </div>
      );
    };

    const App = () => {
      const today = todayChicago();
      const [name,setName] = useState('');
      const [birthdate,setBirthdate] = useState('');
      const [results,setResults] = useState(null);
      const [error,setError] = useState('');

      const [access,setAccess] = useState({ active:false, daysLeft:0 });
      const [trialUsed,setTrialUsed] = useState(hasTrialUsed());
      const [showPay,setShowPay] = useState(false);
      const [trialNotice,setTrialNotice] = useState('');
      const [uiError,setUiError] = useState('');

      // Finish Square redirect if present, then check access
      useEffect(()=>{
        (async ()=>{
          try {
            await completeCheckoutFromURL(async ()=>{
              const status = await checkAccess();
              setAccess(status);
              setShowPay(false);
            }, setUiError);
            const status = await checkAccess();
            setAccess(status);
          } catch (e) {
            __fatal('Bootstrap failed', e);
          }
        })();
      },[]);

      const softRateLimitOk = () => {
        const nowMs = Date.now();
        const key = "nw:lastCalc";
        const last = Number(localStorage.getItem(key) || 0);
        if (nowMs - last < 1000) return false;
        localStorage.setItem(key, String(nowMs));
        return true;
      };

      const runCalculations = (b, nameStr) => {
        const lifePath    = calcLifePath(b);
        const expression  = calcExpression(nameStr);
        const soulUrge    = calcSoulUrge(nameStr);
        const personality = calcPersonality(nameStr);
        const py = calcPersonalYear(today,b);
        const pm = calcPersonalMonth(today,b);
        const pd = calcPersonalDay(today,b);
        const dailyForecast   = getDailyFinanceForecast(pd, lifePath);
        const monthlyForecast = getMonthlyFinanceForecast(pm, lifePath);
        setResults({ lifePath, expression, soulUrge, personality, py, pm, pd, todayStr: today.str, dailyForecast, monthlyForecast });
      };

      const handleCalculate = async () => {
        try {
          setError(''); setTrialNotice(''); setUiError('');
          if (!softRateLimitOk()) return setError('One moment... try again.');
          if (!birthdate || !name) return setError('Please enter both name and birthdate.');
          const valid = validateFullBirthName(name); if (!valid.ok) return setError(valid.msg);
          const b = parseBirth(birthdate); if (!b) return setError('Enter a valid birthdate (MM/DD/YYYY).');

          if (access.active) return runCalculations(b, name);

          if (!trialUsed) {
            runCalculations(b, name);
            markTrialUsed();
            setTrialUsed(true);
            setTrialNotice('That was your free try. Unlock 30-day access to continue using the app.');
            return;
          }
          setShowPay(true);
        } catch (e) {
          __fatal('Calculate failed', e);
        }
      };

      const unlock = async () => {
        try { await startCheckout(setUiError); } catch (e) { __fatal('Checkout start failed', e); }
      };

      const resetAccess = ()=>{
        try {
          clearToken();
          setAccess({ active:false, daysLeft:0 });
          setShowPay(false);
        } catch (e) { __fatal('Reset failed', e); }
      };

      const accessBadge = access.active
        ? `Access: ${access.daysLeft} day${access.daysLeft===1?'':'s'} left`
        : (trialUsed ? 'Trial used — unlock access' : 'Free trial: 1 calculation');

      return (
        <div className="w-full max-w-4xl">
          <div className="glass-card rounded-3xl p-6 md:p-8">
            <div className="flex items-center justify-between gap-3 mb-2">
              <div className="flex items-center gap-3">
                <span className="inline-flex items-center justify-center w-9 h-9 rounded-lg pill">
                  <svg viewBox="0 0 24 24" className="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" strokeWidth="1.7">
                    <path d="M7 4v16m0-10h4m-4 0v-4m4 4v4m6-8v16m0-10h-4m4 0v-4m-4 4v4"/>
                  </svg>
                </span>
                <h1 className="text-2xl md:text-3xl font-bold tracking-tight">NumeraWealth <span className="text-emerald-400">Trader</span></h1>
              </div>
              <div className="flex items-center gap-2">
                <span className="badge">{accessBadge}</span>
                {access.active && (
                  <button onClick={resetAccess} className="btn-ghost px-3 py-1.5 rounded-lg text-sm">Sign out</button>
                )}
              </div>
            </div>

            <p className="text-center text-slate-400 mb-6">Enter your <strong>full birth name</strong> (First <u>Middle</u> Last) and birthdate.</p>

            <div className="grid md:grid-cols-2 gap-4 mb-4">
              <div>
                <label className="block text-sm font-medium text-slate-300">Full Birth Name (Middle required)</label>
                <input value={name} onChange={(e)=>{setName(e.target.value); setResults(null); setTrialNotice('');}} placeholder="First Middle Last" className="input mt-1 block w-full rounded-lg p-2"/>
                <p className="text-xs text-slate-500 mt-1">No initials. Hyphens/apostrophes are okay.</p>
              </div>
              <div>
                <label className="block text-sm font-medium text-slate-300">Birthdate (MM/DD/YYYY)</label>
                <input value={birthdate} onChange={(e)=>{setBirthdate(e.target.value); setResults(null); setTrialNotice('');}} placeholder="MM/DD/YYYY" className="input mt-1 block w-full rounded-lg p-2"/>
              </div>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-3 mb-4">
              <button onClick={()=>{ setShowPay(true); setUiError(''); }} className="btn-ghost text-white py-2 rounded-lg">
                Unlock {PRICE_TEXT}
              </button>
              <button onClick={handleCalculate} className="btn-primary text-white py-2 rounded-lg">
                Calculate
              </button>
            </div>

            {trialNotice && !access.active && (
              <div className="mt-3 text-center note">{trialNotice}</div>
            )}

            {error && <div className="mt-4 p-3 rounded-lg bg-red-900/40 text-red-200 border border-red-500/30">{error}</div>}

            {results && !error && (
              <div className="mt-6 grid gap-4">
                <div className="grid md:grid-cols-3 gap-4">
                  <Card title="Life Path" value={<span className={MASTER.has(results.lifePath)?'master':''}>{fmtNum(results.lifePath)}</span>} />
                  <Card title="Expression / Destiny" value={<span className={MASTER.has(results.expression)?'master':''}>{fmtNum(results.expression)}</span>} />
                  <Card title="Soul Urge" value={<span className={MASTER.has(results.soulUrge)?'master':''}>{fmtNum(results.soulUrge)}</span>} />
                </div>
                <div className="grid md:grid-cols-3 gap-4">
                  <Card title="Personality" value={<span className={MASTER.has(results.personality.reduced)?'master':''}>{`${results.personality.compound} / ${fmtNum(results.personality.reduced)}`}</span>} />
                  <Card title="Personal Year" value={<span className={MASTER.has(results.py)?'master':''}>{fmtNum(results.py)}</span>} />
                  <Card title="Personal Month" value={<span className={MASTER.has(results.pm)?'master':''}>{fmtNum(results.pm)}</span>} />
                </div>
                <div className="grid md:grid-cols-3 gap-4">
                  <Card title="Personal Day" value={<span className={MASTER.has(results.pd)?'master':''}>{fmtNum(results.pd)}</span>} />
                  <Card title="Today" value={results.todayStr}/>
                  <Card title="Master Highlights" value={masterHighlights(results)} />
                </div>
                <div className="grid md:grid-cols-2 gap-4">
                  <Card title="Daily Forecast (Finance)" value={results.dailyForecast}/>
                  <Card title="Monthly Forecast (Finance)" value={results.monthlyForecast}/>
                </div>
              </div>
            )}
          </div>

          {showPay && <Paywall onCheckout={unlock} uiError={uiError}/>}
        </div>
      );
    };

    try {
      ReactDOM.render(<App/>, document.getElementById('root'));
    } catch (e) {
      __fatal('Render failed', e);
    }
  </script>
</body>
</html>

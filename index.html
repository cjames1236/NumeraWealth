<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NumeraWealth</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.20.15/babel.min.js"></script>
</head>
<body class="bg-gray-100">
  <div id="root" class="min-h-screen flex items-center justify-center p-4"></div>

  <script type="text/babel">
    const { useState } = React;

    // --- Numerology constants/helpers ---
    const MASTER = new Set([11,22,33]);
    const LETTER_VALUES = {
      A:1,B:2,C:3,D:4,E:5,F:6,G:7,H:8,I:9,
      J:1,K:2,L:3,M:4,N:5,O:6,P:7,Q:8,R:9,
      S:1,T:2,U:3,V:4,W:5,X:6,Y:7,Z:8
    };
    const VOWELS = new Set(['A','E','I','O','U']);

    const onlyLetters = (s) => (s||'').toUpperCase().replace(/[^A-Z\s'-]/g,'');
    const splitWords = (s) => onlyLetters(s).split(/[ \-']+/).filter(Boolean);

    const sumDigits = (n) => String(Math.abs(Number(n)||0)).split('').reduce((s,d)=>s+Number(d),0);
    const reduceNumber = (n) => { n = Math.abs(Number(n)||0); while (n>9 && !MASTER.has(n)) n = sumDigits(n); return n; };
    const reduceComponents = (...nums) => reduceNumber(nums.map(reduceNumber).reduce((a,b)=>a+b,0));

    // Contextual Y rules
    const isVowelY = (word, idx) => {
      const chars = [...word];
      const prev = chars[idx-1];
      const next = chars[idx+1];
      const nextIsVowel = next && VOWELS.has(next);
      const prevIsVowel = prev && VOWELS.has(prev);
      const prevIsConsonant = prev && !prevIsVowel;
      if (idx === 0 && nextIsVowel) return false; // Ya/Yo/Yu
      if (nextIsVowel) return false;              // followed by vowel
      if (prevIsConsonant && !nextIsVowel) return true;
      if (!prevIsVowel && !nextIsVowel) return true;
      return false;
    };

    const classifyNameLetters = (name) => {
      const words = splitWords(name);
      let vowelsSum=0, consonantsSum=0, allSum=0;
      for (const w of words) {
        const chars = [...w];
        chars.forEach((ch,i) => {
          if (ch==='Y') {
            const yIsVowel = isVowelY(w,i);
            if (yIsVowel) vowelsSum += LETTER_VALUES[ch]||0; else consonantsSum += LETTER_VALUES[ch]||0;
          } else if (VOWELS.has(ch)) { vowelsSum += LETTER_VALUES[ch]||0; }
          else { consonantsSum += LETTER_VALUES[ch]||0; }
          allSum += LETTER_VALUES[ch]||0;
        });
      }
      return { vowelsSum, consonantsSum, allSum };
    };

    // Today in America/Chicago
    const todayChicago = () => {
      const parts = new Intl.DateTimeFormat('en-US', { timeZone:'America/Chicago', year:'numeric', month:'2-digit', day:'2-digit' }).formatToParts(new Date());
      const get = (t) => Number(parts.find(p=>p.type===t).value);
      const m=get('month'), d=get('day'), y=get('year');
      return { m,d,y, str:`${String(m).padStart(2,'0')}/${String(d).padStart(2,'0')}/${y}` };
    };

    // Parse birthdate
    const parseBirth = (s) => {
      const a = (s||'').trim().split('/');
      if (a.length!==3) return null;
      const [M,D,Y] = a.map(Number);
      if (!M||!D||!Y||M<1||M>12||Y<1800||Y>3000) return null;
      const maxD = new Date(Y,M,0).getDate();
      if (D<1||D>maxD) return null;
      return { m:M, d:D, y:Y };
    };

    // --- Name validation: require First + FULL Middle + Last (no initials) ---
    const validateFullBirthName = (name) => {
      const words = splitWords(name);
      if (words.length < 3) return { ok:false, msg:'Enter your full birth name: First Middle Last.' };
      // all middle words (everything except first & last) must be length >= 2
      const middles = words.slice(1, -1);
      if (middles.some(w => w.length < 2)) return { ok:false, msg:'Please enter your FULL middle name (no initials).' };
      return { ok:true, msg:'' };
    };

    // Core numbers
    const calcLifePath = (b) => reduceComponents(b.m,b.d,b.y);
    const calcExpression = (name) => { const { allSum } = classifyNameLetters(name); return reduceNumber(allSum); };
    const calcSoulUrge  = (name) => { const { vowelsSum } = classifyNameLetters(name); return reduceNumber(vowelsSum); };
    const calcPersonality = (name) => {
      const { consonantsSum } = classifyNameLetters(name);
      return { compound: consonantsSum, reduced: reduceNumber(consonantsSum) };
    };

    const calcPersonalYear  = (today,b) => reduceNumber(reduceNumber(b.m)+reduceNumber(b.d)+reduceNumber(today.y));
    const calcPersonalMonth = (today,b) => reduceNumber(calcPersonalYear(today,b)+today.m);
    const calcPersonalDay   = (today,b) => reduceNumber(calcPersonalMonth(today,b)+today.d);

    // --- Finance-focused Forecast ---
    const PD_FINANCE = {
      1: "Initiation day: open pilots, start positions, or launch a plan. Keep risk defined.",
      2: "Partnership day: collaborate, hedge, or build spreads. Patience beats forcing trades.",
      3: "Communication day: pitch ideas, journal setups, review trade plans; light sizing.",
      4: "Structure day: tighten risk, rebalance, pay down debt, and build checklists.",
      5: "Volatility day: trade momentum or scalp, but cap size and respect stops.",
      6: "Income day: focus on cash flowâ€”dividends, covered calls, budgets, repairs.",
      7: "Research day: backtest, study tape, wait for A+ setups; fewer trades, higher quality.",
      8: "Power day: push negotiations, scale winners, review KPIs; results-driven moves.",
      9: "Completion day: harvest profits, cut laggards, tidy accounts, and reset.",
      11:"Insight day: small asymmetric shots from clear signals; protect capital.",
      22:"Build day: automate, systematize, and place long-term bricks that compound.",
      33:"Service day: mentor, support customers, strengthen relationships that monetize later."
    };
    const LP_TINT = {
      1:" Favor bold but measured starts.",
      2:" Favor cooperative deals and nuance.",
      3:" Favor brand, comms, and creative angles.",
      4:" Favor process, discipline, and durability.",
      5:" Favor flexibility and adaptive edges.",
      6:" Favor stewardship, quality, and loyalty.",
      7:" Favor analysis, timing, and patience.",
      8:" Favor ambition, metrics, and leverage.",
      9:" Favor perspective, pruning, and impact.",
      11:" Favor intuition paired with validation.",
      22:" Favor scalable systems and foundations.",
      33:" Favor teaching and value-through-service."
    };
    const getFinanceForecast = (pd, lp) => (PD_FINANCE[pd] || "Balanced day: follow the plan and manage risk.") + (LP_TINT[lp] || "");

    // --- App ---
    const App = () => {
      const today = todayChicago();
      const [name,setName] = useState('');
      const [birthdate,setBirthdate] = useState('');
      const [results,setResults] = useState(null);
      const [error,setError] = useState('');

      const handleCalculate = () => {
        setError('');
        if (!birthdate || !name) { setError('Please enter both name and birthdate.'); return; }

        const validName = validateFullBirthName(name);
        if (!validName.ok) { setError(validName.msg); return; }

        const b = parseBirth(birthdate);
        if (!b) { setError('Enter a valid birthdate (MM/DD/YYYY).'); return; }

        const lifePath = calcLifePath(b);
        const expression = calcExpression(name);
        const soulUrge  = calcSoulUrge(name);
        const personality = calcPersonality(name);
        const py = calcPersonalYear(today,b);
        const pm = calcPersonalMonth(today,b);
        const pd = calcPersonalDay(today,b);
        const forecast = getFinanceForecast(pd, lifePath);

        setResults({ lifePath, expression, soulUrge, personality, py, pm, pd, todayStr: today.str, forecast });
      };

      // Clear results when editing
      const onNameChange  = (e) => { setName(e.target.value); setResults(null); };
      const onBirthChange = (e) => { setBirthdate(e.target.value); setResults(null); };

      return (
        <div className="w-full max-w-2xl mx-auto bg-white rounded-2xl shadow-xl p-6">
          <h1 className="text-3xl font-bold text-center mb-2">NumeraWealth</h1>
          <p className="text-center text-gray-500 mb-4">Enter your <strong>full birth name</strong> (First <u>Middle</u> Last) and birthdate.</p>

          <div className="grid md:grid-cols-2 gap-4 mb-4">
            <div>
              <label className="block text-sm font-medium">Full Birth Name (Middle required)</label>
              <input value={name} onChange={onNameChange} placeholder="First Middle Last"
                     className="mt-1 block w-full border-gray-300 rounded-md p-2"/>
              <p className="text-xs text-gray-500 mt-1">No initials. Hyphens/apostrophes OK.</p>
            </div>
            <div>
              <label className="block text-sm font-medium">Birthdate (MM/DD/YYYY)</label>
              <input value={birthdate} onChange={onBirthChange} placeholder="MM/DD/YYYY"
                     className="mt-1 block w-full border-gray-300 rounded-md p-2"/>
            </div>
          </div>

          <button
            onClick={handleCalculate}
            className="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700"
          >
            Calculate
          </button>

          {error && <div className="mt-4 p-3 bg-red-100 text-red-700 rounded">{error}</div>}

          {results && !error && (
            <div className="mt-6 grid gap-4">
              <Card title="Life Path" value={results.lifePath}/>
              <Card title="Expression / Destiny" value={results.expression}/>
              <Card title="Soul Urge" value={results.soulUrge}/>
              <Card title="Personality" value={`${results.personality.compound} / ${results.personality.reduced}`}/>
              <Card title="Personal Year" value={results.py}/>
              <Card title="Personal Month" value={results.pm}/>
              <Card title="Personal Day" value={results.pd}/>
              <Card title="Today" value={results.todayStr}/>
              <Card title="Daily Forecast (Finance)" value={results.forecast}/>
            </div>
          )}
        </div>
      );
    };

    const Card = ({title,value}) => (
      <div className="p-4 border rounded shadow-sm">
        <div className="text-sm text-gray-500">{title}</div>
        <div className="text-lg font-semibold whitespace-pre-wrap">{value}</div>
      </div>
    );

    ReactDOM.render(<App/>, document.getElementById('root'));
  </script>
</body>
</html>
